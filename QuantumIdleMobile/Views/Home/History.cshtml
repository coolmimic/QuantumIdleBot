@{
    ViewData["Title"] = "å¼€å¥–å†å²";
}

<div class="page-container">
    <div class="header">
        <h1>ğŸ“Š å¼€å¥–å†å²</h1>
        <button class="btn-icon" onclick="refreshHistory()">åˆ·æ–°</button>
    </div>
    
    <div class="content">
        <div class="card">
            <div class="form-group" style="margin-bottom: 0;">
                <label for="groupSelect">é€‰æ‹©ç¾¤ç»„</label>
                <select id="groupSelect" class="form-input" onchange="loadHistory()">
                    <option value="">é€‰æ‹©ç¾¤ç»„æŸ¥çœ‹å†å²...</option>
                </select>
            </div>
        </div>

        <div id="historyList">
            <div class="info-card">
                <p>ğŸ’¡ å¼€å¥–å†å²åŠŸèƒ½éœ€è¦è¿æ¥ Telegram åä½¿ç”¨</p>
                <p>è¯·å…ˆåœ¨ "TGè¿æ¥" é¡µé¢è¿æ¥æ‚¨çš„ Telegram è´¦å·ã€‚</p>
            </div>
        </div>
    </div>
    
    <div class="bottom-nav">
        <a href="/Home/Dashboard" class="nav-item">
            <span class="nav-icon">ğŸ </span>
            <span class="nav-text">é¦–é¡µ</span>
        </a>
        <a href="/Home/Telegram" class="nav-item">
            <span class="nav-icon">ğŸ“±</span>
            <span class="nav-text">TGè¿æ¥</span>
        </a>
        <a href="/Home/Schemes" class="nav-item">
            <span class="nav-icon">ğŸ“‹</span>
            <span class="nav-text">æ–¹æ¡ˆ</span>
        </a>
        <a href="/Home/History" class="nav-item active">
            <span class="nav-icon">ğŸ“Š</span>
            <span class="nav-text">å†å²</span>
        </a>
        <a href="/Home/Settings" class="nav-item">
            <span class="nav-icon">âš™ï¸</span>
            <span class="nav-text">è®¾ç½®</span>
        </a>
    </div>
</div>

@section Scripts {
<script>
    // åŠ¨æ€æ„å»º API åœ°å€ï¼Œé€‚é…å†…ç½‘å’Œå¤–ç½‘è®¿é—®
    const API_BASE_URL = '/api';
    const token = localStorage.getItem('token');
    
    if (!token) {
        window.location.href = '/Home/Login';
    }

    async function loadGroups() {
        try {
            const response = await fetch(`${API_BASE_URL}/telegram/chats`, {
                headers: {
                    'Authorization': `Bearer ${token}`
                }
            });
            
            const result = await response.json();
            
            if (result.success && result.data && result.data.length > 0) {
                const select = document.getElementById('groupSelect');
                result.data.forEach(chat => {
                    const option = document.createElement('option');
                    option.value = chat.id;
                    option.textContent = `${chat.name} (${chat.isChannel ? 'é¢‘é“' : 'ç¾¤ç»„'})`;
                    select.appendChild(option);
                });
                
                // æ›´æ–°å†å²åˆ—è¡¨æç¤º
                document.getElementById('historyList').innerHTML = `
                    <div class="empty-state">è¯·é€‰æ‹©ä¸€ä¸ªç¾¤ç»„æŸ¥çœ‹å¼€å¥–å†å²</div>
                `;
            }
        } catch (error) {
            console.error('åŠ è½½ç¾¤ç»„å¤±è´¥:', error);
        }
    }

    function loadHistory() {
        const groupId = document.getElementById('groupSelect').value;
        if (!groupId) {
            document.getElementById('historyList').innerHTML = `
                <div class="empty-state">è¯·é€‰æ‹©ä¸€ä¸ªç¾¤ç»„æŸ¥çœ‹å¼€å¥–å†å²</div>
            `;
            return;
        }
        
        // TODO: è°ƒç”¨åç«¯ API è·å–å¼€å¥–å†å²
        document.getElementById('historyList').innerHTML = `
            <div class="card">
                <h3>å¼€å¥–è®°å½•</h3>
                <div class="empty-state">
                    è¯¥åŠŸèƒ½å¼€å‘ä¸­ï¼Œæ•¬è¯·æœŸå¾…...
                </div>
            </div>
        `;
    }

    function refreshHistory() {
        loadHistory();
    }

    // é¡µé¢åŠ è½½æ—¶åŠ è½½ç¾¤ç»„
    loadGroups();
</script>
}
