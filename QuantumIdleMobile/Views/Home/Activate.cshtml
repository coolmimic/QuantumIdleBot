@{
    ViewData["Title"] = "æ¿€æ´»å¡å¯†";
    Layout = "_Layout";
}

<div class="auth-container">
    <div class="auth-card">
        <div class="auth-logo">
            <h1>ğŸ”‘ æ¿€æ´»å¡å¯†</h1>
            <p>è¾“å…¥ç”¨æˆ·åå’Œå¡å¯†æ¿€æ´»è´¦æˆ·</p>
        </div>
        
        <form id="activateForm">
            <div class="form-group">
                <label for="username">ç”¨æˆ·å</label>
                <input type="text" id="username" name="username" class="form-input" 
                       placeholder="è¯·è¾“å…¥ç”¨æˆ·å" required />
            </div>
            
            <div class="form-group">
                <label for="cardCode">å¡å¯†</label>
                <input type="text" id="cardCode" name="cardCode" class="form-input" 
                       placeholder="è¯·è¾“å…¥å¡å¯†" required />
            </div>
            
            <div class="form-group">
                <button type="submit" class="btn btn-primary btn-block" id="activateBtn">
                    æ¿€æ´»
                </button>
            </div>
            
            <div id="resultMessage" style="display: none; margin-top: 12px;"></div>
        </form>
        
        <div class="auth-footer">
            <a href="/Home/Login">â† è¿”å›ç™»å½•</a>
        </div>
    </div>
</div>

@section Scripts {
<script>
    const API_BASE_URL = API_CONFIG.baseUrl;

    document.getElementById('activateForm').addEventListener('submit', async function(e) {
        e.preventDefault();
        
        const username = document.getElementById('username').value.trim();
        const cardCode = document.getElementById('cardCode').value.trim();
        const resultDiv = document.getElementById('resultMessage');
        const btn = document.getElementById('activateBtn');
        
        btn.disabled = true;
        btn.textContent = 'æ¿€æ´»ä¸­...';
        resultDiv.style.display = 'none';
        
        try {
            const response = await fetch(`${API_BASE_URL}/cardkey/activate`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ userName: username, cardCode: cardCode })
            });
            
            const result = await response.json();
            
            if (result.success) {
                resultDiv.innerHTML = `<div style="color: var(--success-color); padding: 12px; background: rgba(82, 196, 26, 0.1); border-radius: var(--radius-sm);">âœ… ${result.message}</div>`;
            } else {
                resultDiv.innerHTML = `<div style="color: var(--error-color); padding: 12px; background: rgba(255, 77, 79, 0.1); border-radius: var(--radius-sm);">âŒ ${result.message}</div>`;
            }
            resultDiv.style.display = 'block';
        } catch (error) {
            resultDiv.innerHTML = `<div style="color: var(--error-color); padding: 12px; background: rgba(255, 77, 79, 0.1); border-radius: var(--radius-sm);">âŒ ç½‘ç»œé”™è¯¯</div>`;
            resultDiv.style.display = 'block';
        } finally {
            btn.disabled = false;
            btn.textContent = 'æ¿€æ´»';
        }
    });
</script>
}
