@{
    ViewData["Title"] = "ç®¡ç†å‘˜ - å¡å¯†ç”Ÿæˆ";
}

<div class="page-container">
    <div class="header">
        <h1>ğŸ”‘ å¡å¯†ç”Ÿæˆ</h1>
    </div>
    
    <div class="content">
        <div class="card">
            <h3>ç®¡ç†å‘˜éªŒè¯</h3>
            <div class="form-group">
                <label for="adminPassword">ç®¡ç†å‘˜å¯†ç </label>
                <input type="password" id="adminPassword" class="form-input" placeholder="è¯·è¾“å…¥ç®¡ç†å‘˜å¯†ç " />
            </div>
            
            <div class="form-group">
                <label for="durationDays">æœ‰æ•ˆå¤©æ•°</label>
                <input type="number" id="durationDays" class="form-input" value="30" min="1" max="3650" />
            </div>
            
            <div class="form-group">
                <label for="remark">å¤‡æ³¨ï¼ˆå¯é€‰ï¼‰</label>
                <input type="text" id="remark" class="form-input" placeholder="ä¾‹å¦‚ï¼šVIPå®¢æˆ·" />
            </div>
            
            <button class="btn btn-primary btn-block" onclick="generateCard()" id="generateBtn">
                ç”Ÿæˆå¡å¯†
            </button>
        </div>
        
        <!-- ç”Ÿæˆç»“æœ -->
        <div class="card" id="resultCard" style="display: none;">
            <h3>âœ… å¡å¯†ç”ŸæˆæˆåŠŸ</h3>
            <div class="result-container">
                <div class="card-code" id="generatedCode">-</div>
                <div class="card-info">
                    <span>æœ‰æ•ˆæœŸï¼š<strong id="cardDays">-</strong> å¤©</span>
                </div>
                <button class="btn btn-secondary btn-block" onclick="copyCode()">
                    ğŸ“‹ å¤åˆ¶å¡å¯†
                </button>
            </div>
        </div>
        
        <div class="card" style="margin-top: 24px;">
            <a href="/Home/Login" class="btn btn-secondary btn-block">
                è¿”å›ç™»å½•é¡µ
            </a>
        </div>
    </div>
</div>

<style>
    .result-container {
        text-align: center;
        padding: 16px 0;
    }
    .card-code {
        background: var(--bg-tertiary);
        padding: 16px;
        border-radius: var(--radius-md);
        font-family: 'Consolas', monospace;
        font-size: 14px;
        word-break: break-all;
        margin-bottom: 12px;
        user-select: all;
        cursor: pointer;
    }
    .card-info {
        color: var(--text-secondary);
        font-size: 14px;
        margin-bottom: 16px;
    }
</style>

@section Scripts {
<script>
    const API_BASE_URL = '/api';
    
    async function generateCard() {
        const adminPassword = document.getElementById('adminPassword').value.trim();
        const durationDays = parseInt(document.getElementById('durationDays').value);
        const remark = document.getElementById('remark').value.trim();
        
        if (!adminPassword) {
            alert('è¯·è¾“å…¥ç®¡ç†å‘˜å¯†ç ');
            return;
        }
        
        if (!durationDays || durationDays < 1) {
            alert('è¯·è¾“å…¥æœ‰æ•ˆçš„å¤©æ•°');
            return;
        }
        
        const btn = document.getElementById('generateBtn');
        btn.disabled = true;
        btn.textContent = 'ç”Ÿæˆä¸­...';
        
        try {
            const response = await fetch(`${API_BASE_URL}/cardkey/generate`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    adminPassword: adminPassword,
                    durationDays: durationDays,
                    remark: remark || 'Web-Admin'
                })
            });
            
            const result = await response.json();
            
            if (result.success) {
                document.getElementById('generatedCode').textContent = result.data;
                document.getElementById('cardDays').textContent = result.days;
                document.getElementById('resultCard').style.display = 'block';
            } else {
                alert(result.message || 'ç”Ÿæˆå¤±è´¥');
            }
        } catch (error) {
            alert('ç½‘ç»œé”™è¯¯: ' + error.message);
        } finally {
            btn.disabled = false;
            btn.textContent = 'ç”Ÿæˆå¡å¯†';
        }
    }
    
    function copyCode() {
        const code = document.getElementById('generatedCode').textContent;
        navigator.clipboard.writeText(code).then(() => {
            alert('âœ… å¡å¯†å·²å¤åˆ¶åˆ°å‰ªè´´æ¿');
        }).catch(() => {
            // Fallback
            const textArea = document.createElement('textarea');
            textArea.value = code;
            document.body.appendChild(textArea);
            textArea.select();
            document.execCommand('copy');
            document.body.removeChild(textArea);
            alert('âœ… å¡å¯†å·²å¤åˆ¶åˆ°å‰ªè´´æ¿');
        });
    }
</script>
}
